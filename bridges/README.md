# PLTelemetry Bridges

This directory contains backend-specific bridge implementations for PLTelemetry. Each bridge transforms the generic OpenTelemetry-compliant JSON format generated by PLTelemetry into the format required by specific backends.

## 🌉 What is a Bridge?

A bridge is an adapter that:
- Receives generic telemetry data from PLTelemetry
- Transforms it to backend-specific format
- Handles authentication and connection details
- Manages backend-specific requirements (e.g., foreign keys, field names)

## 📦 Available Bridges

### Production Ready

#### [PostgreSQL](postgresql/)
- **Status**: ✅ Production Ready
- **Languages**: Oracle PL/SQL
- **Backend**: PostgreSQL via PostgREST
- **Features**:
  - Full traces, spans, and metrics support
  - Handles foreign key dependencies
  - Character escaping for special characters
  - Both sync and async modes

### In Development

#### [Elasticsearch](elasticsearch/) 
- **Status**: 🚧 Coming Soon
- **Languages**: Oracle PL/SQL, Node.js
- **Backend**: Elasticsearch 8.x
- **Features**: Full-text search, aggregations

#### [InfluxDB](influxdb/)
- **Status**: 📋 Planned
- **Languages**: Oracle PL/SQL, Python
- **Backend**: InfluxDB 2.x
- **Features**: Time-series optimized

#### [Jaeger](jaeger/)
- **Status**: 📋 Planned
- **Languages**: Oracle PL/SQL, Java
- **Backend**: Jaeger
- **Features**: Distributed tracing UI

## 🏗️ Bridge Architecture

```
┌─────────────────┐    Generic JSON    ┌─────────────────┐    Backend Format    ┌──────────────┐
│   PLTelemetry   │ ─────────────────▶ │     Bridge      │ ──────────────────▶ │    Backend   │
│     (Core)      │                    │    (Adapter)    │                      │  (Database)  │
└─────────────────┘                    └─────────────────┘                      └──────────────┘
```

## 📐 Generic JSON Format

PLTelemetry generates JSON in this format:

### Traces
```json
{
  "trace_id": "32-char-hex-string",
  "operation": "operation_name",
  "start_time": "2025-01-01T12:00:00.000Z",
  "service_name": "oracle-plsql"
}
```

### Spans
```json
{
  "trace_id": "32-char-hex-string",
  "span_id": "16-char-hex-string",
  "parent_span_id": "16-char-hex-string",
  "operation": "operation_name",
  "start_time": "2025-01-01T12:00:00.000Z",
  "end_time": "2025-01-01T12:00:01.000Z",
  "duration_ms": 1000,
  "status": "OK",
  "attributes": {}
}
```

### Metrics
```json
{
  "name": "metric_name",
  "value": 123.45,
  "unit": "ms",
  "timestamp": "2025-01-01T12:00:00.000Z",
  "trace_id": "32-char-hex-string",
  "span_id": "16-char-hex-string",
  "attributes": {}
}
```

## 🛠️ Creating a New Bridge

### 1. Copy the Template

```bash
cp -r template/ my-backend/
```

### 2. Bridge Requirements

Your bridge must:

- ✅ Transform generic JSON to backend format
- ✅ Handle all errors gracefully (never break the application)
- ✅ Support both sync and async modes if possible
- ✅ Include comprehensive examples
- ✅ Document backend-specific setup

### 3. Implementation Checklist

#### For Oracle PL/SQL bridges:

- [ ] Create package specification (`PLT_MYBACKEND_BRIDGE.pks`)
- [ ] Create package body (`PLT_MYBACKEND_BRIDGE.pkb`)
- [ ] Implement required procedures:
  - `send_trace_to_backend`
  - `send_span_to_backend`
  - `send_metric_to_backend`
  - `route_to_backend` (for generic routing)
- [ ] Handle special characters and escaping
- [ ] Create installation script
- [ ] Write examples for all modes

#### For Other Languages:

- [ ] Parse generic JSON from PLTelemetry
- [ ] Transform to backend format
- [ ] Handle authentication
- [ ] Implement retry logic
- [ ] Add logging/debugging capabilities

### 4. Directory Structure

```
my-backend/
├── README.md                 # Backend-specific documentation
├── oracle/                   # Oracle PL/SQL implementation
│   ├── src/
│   │   ├── PLT_MYBACKEND_BRIDGE.pks
│   │   └── PLT_MYBACKEND_BRIDGE.pkb
│   ├── install.sql
│   └── examples/
├── nodejs/                   # Node.js implementation (optional)
│   ├── package.json
│   ├── src/
│   └── examples/
└── schema/                   # Backend setup files
    └── setup.sql
```

## 🧪 Testing Your Bridge

### Basic Test

```sql
-- Configure
BEGIN
    PLTelemetry.set_backend_url('MYBACKEND_BRIDGE');
    PLT_MYBACKEND_BRIDGE.set_endpoint('http://localhost:NNNN');
END;
/

-- Create test data
DECLARE
    l_trace_id VARCHAR2(32);
    l_span_id  VARCHAR2(16);
BEGIN
    l_trace_id := PLTelemetry.start_trace('bridge_test');
    l_span_id := PLTelemetry.start_span('test_operation');
    PLTelemetry.end_span(l_span_id, 'OK');
    PLTelemetry.log_metric('test_metric', 123, 'units');
END;
/
```

### Test Checklist

- [ ] Single span with metric
- [ ] Nested spans
- [ ] Error handling (network failures)
- [ ] Special characters in data
- [ ] Large payloads
- [ ] Concurrent requests

## 📊 Bridge Comparison

| Bridge | Language | Backend | Sync | Async | Batch | Auth |
|--------|----------|---------|------|-------|-------|------|
| PostgreSQL | PL/SQL | PostgREST | ✅ | ✅ | ❌ | DB Users |
| Elasticsearch | PL/SQL, Node.js | HTTP/REST | ✅ | ✅ | ✅ | API Key |
| InfluxDB | PL/SQL, Python | HTTP/Line | ✅ | ✅ | ✅ | Token |
| Jaeger | PL/SQL, Java | gRPC/HTTP | ✅ | ✅ | ✅ | None |

## 🤝 Contributing

1. Fork the repository
2. Create your bridge following the template
3. Add comprehensive documentation
4. Include working examples
5. Test thoroughly
6. Submit a pull request

### Contribution Guidelines

- Use English for all documentation and code comments
- Follow the established directory structure
- Include error handling for all external calls
- Never let telemetry break the main application
- Add your bridge to this README

## 📚 Resources

- [OpenTelemetry Specification](https://opentelemetry.io/docs/reference/specification/)
- [PLTelemetry Core Documentation](../README.md)

